{% extends 'problem.html' %}

{% block description %}
	<div id="description">
		<p>The sum of the squares of the first ten natural numbers is: <br><i>1<sup>2</sup> + 2<sup>2</sup> + ... + 10<sup>2</sup> = 385</i><br><br>The square of the sum of the first ten natural numbers is: <br><i>(1 + 2 + ... + 10)<sup>2</sup> = 552 = 3025</i><br><br>Hence the difference between the sum of the squares of the first ten natural numbers and the square of the sum is <i>3025 âˆ’ 385 = 2640</i>.<br><br></p>
	</div>
{% endblock %}

{% block content %}
	<button id="solution-button" style="top:270px">
		<span class="ui-button-text">Show Solution</span>
	</button>

	<div id="solution">
		<p>We solve this with the following three functions:</p>
		<code>	
			def calculate_difference(n):<br>
			&nbsp;&nbsp;&nbsp;return square_of_sums(n) - sum_of_squares(n)
			<br><br>
			def sum_of_squares(n):<br>
			&nbsp;&nbsp;&nbsp;return sum([ i * i for i in xrange(1, n + 1) ])
			<br><br>
			def square_of_sums(n):<br>
			&nbsp;&nbsp;&nbsp;return sum([ i for i in xrange(1, n + 1) ]) ** 2
		</code>
	</div>
	<div id="input-area">
		<p>Enter any number to see it in action!</p>
		<input type="text" id="id_calculator" value="">
		<input type="submit" id="submit-button" value="Calculate">
	</div>

	<div id="output-area">
		<table id="request-table" width="700px">
			<caption>Calculation Log</caption>
			<tbody>
				<tr id="headers">
					<td class="table-header">Number</td>
					<td class="table-header">Difference</td>
					<td class="table-header">Timestamp</td>
				</tr>
				<tr id="placeholders">
					<td id="number-result">&nbsp;</td>
					<td id="value-result">&nbsp;</td>
					<td id="time-result">&nbsp;</td>
				</tr>
			</tbody>
		</table>
	</div>
{% endblock %}

	{% block extra_body_content %}
		<script>
			$(document).ready(function () {
			    function calculateResult(number) {
			        $.ajax({
			        	// hard coded urls are bad
			            // url: 'http://localhost:8000/difference?number=' + number,
			            url: '{% url "get_sum_square_difference" %}' + '?number=' + number,
			            type: 'get',
			            contentType: 'application/json',
			            success: function(response) {
			            	// fill table cells with results
			            	var response_data = JSON.parse(response);

			            	// check for existing entries for this number and remove
			            	$("#request-table tr td:nth-child(1)").each(function () {
			            		if (response_data.number == $(this).html()) {
			            			$(this).closest('tr').css('display', 'None');
			            		}
							});

			            	// prepend to top of the table
			            	$('#headers').after(
							    '<tr><td>' + 
							    	response_data.number + '</td><td>' +
							    	response_data.value  + '</td><td>' +
							    	response_data.last_requested  +
							    '</td></tr>');
			            },
			            error: function (jqXhr, textStatus, errorThrown) {
			                console.log(errorThrown);
			            }
			        });
			    };

			    $("#submit-button").click(function(){
			        var number = $( "#id_calculator" ).val()
			        calculateResult(number)
		    	});

		    	$("#solution-button").click(function(){
			        if ($("#solution").is(":visible")) {
						$("#solution").slideUp(500);
						$("#solution-button span").text('Show solution');
			        } else {
			        	$("#solution").slideDown(500);
			        	$("#solution-button span").text('Hide solution');
			        }
		    	});
			});
		</script>
	{% endblock %}